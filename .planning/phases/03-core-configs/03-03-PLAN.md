---
phase: 03-core-configs
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - home/.chezmoiignore
  - home/private_dot_oh-my-zsh/custom/completions/_it
autonomous: false

must_haves:
  truths:
    - "Work device has _it completion file after chezmoi apply"
    - "Personal device does NOT have _it completion file"
    - "chezmoi diff shows no noise from oh-my-zsh cache directories"
    - "New shell opens with all features working"
  artifacts:
    - path: "home/.chezmoiignore"
      provides: "Conditional file exclusion including _it on personal devices"
      contains: ".oh-my-zsh/custom/completions/_it"
    - path: "home/private_dot_oh-my-zsh/custom/completions/_it"
      provides: "it tool completion for work devices"
      contains: "#compdef it"
  key_links:
    - from: "home/.chezmoiignore"
      to: "_it completion"
      via: "conditional exclusion"
      pattern: "{{ if not .isWork }}"
---

<objective>
Update .chezmoiignore for shell configs and add work-only _it completion

Purpose: Complete the shell configuration by (1) updating .chezmoiignore to exclude oh-my-zsh cache directories and work-only files on personal devices, and (2) adding the _it completion file that should only exist on work machines.

Output: Updated `.chezmoiignore`, `_it` completion file in chezmoi source
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-configs/03-RESEARCH.md

# Prior plan output
@.planning/phases/03-core-configs/03-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update .chezmoiignore with shell config exclusions</name>
  <files>home/.chezmoiignore</files>
  <action>
Update `.chezmoiignore` to add:

1. **Oh-my-zsh runtime artifacts** (ignore everywhere):
```
# Oh-my-zsh runtime artifacts - never managed
.oh-my-zsh/cache/
.oh-my-zsh/.git/
.oh-my-zsh/log/
.cache/zsh/
```

2. **Work-only files** (update existing section):
```
# Work-only files - ignore on personal devices
{{ if not .isWork }}
.oh-my-zsh/custom/completions/_it
.config/work-tools/
{{ end }}
```

Note: The existing .chezmoiignore already has structure for OS and device conditionals. Merge the new entries with existing patterns. Do NOT duplicate sections.

Read the existing file first, then update it to add the new entries while preserving existing content.
  </action>
  <verify>
- `grep ".oh-my-zsh/cache/" home/.chezmoiignore` finds cache exclusion
- `grep "_it" home/.chezmoiignore` finds work-only exclusion
- `grep "{{ if not .isWork }}" home/.chezmoiignore` finds conditional block
  </verify>
  <done>
.chezmoiignore updated with oh-my-zsh cache exclusions and work-only _it exclusion
  </done>
</task>

<task type="auto">
  <name>Task 2: Add _it completion file for work devices</name>
  <files>home/private_dot_oh-my-zsh/custom/completions/_it</files>
  <action>
Copy the user's existing `_it` completion file into chezmoi source:

1. Create directory structure: `home/private_dot_oh-my-zsh/custom/completions/`
2. Copy from `~/.oh-my-zsh/custom/completions/_it`

The `private_dot_oh-my-zsh` prefix ensures the directory has restricted permissions (700).

This file will be merged with the oh-my-zsh archive from .chezmoiexternal.toml. Chezmoi handles this automatically - the external archive provides the base oh-my-zsh, and our source files overlay on top.

Note: This file will be ignored on personal devices via .chezmoiignore (Task 1).
  </action>
  <verify>
- `ls home/private_dot_oh-my-zsh/custom/completions/_it` exists
- `head -1 home/private_dot_oh-my-zsh/custom/completions/_it` shows "#compdef it"
  </verify>
  <done>
_it completion file exists in chezmoi source under correct path
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete shell configuration with oh-my-zsh, starship, aliases, and work-only tools
  </what-built>
  <how-to-verify>
1. Run `chezmoi apply` to apply all shell configs
2. Open a NEW terminal window (not the current one)
3. Verify the following in the new terminal:

**Basic functionality:**
- [ ] Starship prompt appears (colorful, shows git status in a repo)
- [ ] `ls` shows eza output (icons, colors)
- [ ] `cat ~/.zshrc` shows bat output (syntax highlighting)
- [ ] `z` command works (zoxide)

**Oh-my-zsh:**
- [ ] Tab completion works
- [ ] `alias` shows many git aliases (from oh-my-zsh git plugin)

**Work-only (if this is a work device):**
- [ ] `type it` shows "it is a shell function"
- [ ] `it` tab completion works

**Personal-only (if this is a personal device):**
- [ ] `type it` shows "it not found" or similar
- [ ] No _it file in ~/.oh-my-zsh/custom/completions/

4. Run `chezmoi diff` - should show NO changes (everything applied)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. `chezmoi ignored` - should NOT list .zshrc, starship.toml, alias files
2. `chezmoi managed` - should list all shell config files
3. `chezmoi diff` - should show no unexpected changes
4. New terminal opens with full functionality
</verification>

<success_criteria>
- .chezmoiignore excludes oh-my-zsh cache and work-only files conditionally
- _it completion exists in source and appears only on work devices
- Human verification confirms shell works correctly
- Phase 3 requirements SHELL-01 through SHELL-05 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-configs/03-03-SUMMARY.md`
</output>
