---
phase: 05-bootstrap
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bootstrap.sh
  - SUMMARY.txt
autonomous: true

must_haves:
  truths:
    - "Running curl bootstrap URL | sh on fresh machine installs chezmoi"
    - "Running curl bootstrap URL | sh on fresh machine applies dotfiles"
    - "Script fails with clear message if git, curl, or op missing"
    - "Script detects macOS vs Linux correctly"
  artifacts:
    - path: "bootstrap.sh"
      provides: "Single-command bootstrap entry point"
      min_lines: 60
    - path: "SUMMARY.txt"
      provides: "Post-bootstrap summary message"
      min_lines: 5
  key_links:
    - from: "bootstrap.sh"
      to: "get.chezmoi.io"
      via: "curl download and execute"
      pattern: "curl.*get\\.chezmoi\\.io"
    - from: "bootstrap.sh"
      to: "chezmoi init --apply"
      via: "chezmoi init command"
      pattern: "chezmoi.*init.*--apply"
---

<objective>
Create a single-command bootstrap script that takes a fresh macOS or Linux machine from nothing to a fully configured dev environment.

Purpose: Enable `curl -fsSL <raw_url>/bootstrap.sh | sh` to bootstrap any new device
Output: Working bootstrap.sh + SUMMARY.txt at repository root
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-bootstrap/05-RESEARCH.md
@.planning/phases/05-bootstrap/05-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bootstrap.sh script</name>
  <files>bootstrap.sh</files>
  <action>
Create bootstrap.sh at repository root with:

**Shebang and strict mode:**
```bash
#!/bin/bash
set -euo pipefail
```

**Stage output helper:**
- TOTAL_STAGES variable (4 stages total)
- stage() function that prints `[n/m] emoji message`
- Use emojis per CONTEXT.md: check prerequisites, install chezmoi, run init, summary

**Functions:**
1. `detect_os()` - use `uname -s`, return "darwin" or "linux", exit 1 on unknown
2. `check_prerequisites()` - check git, curl, op using `command -v`
   - For op: also run `op --version` to verify it works (not just present)
   - Exit with clear error listing missing tools
3. `install_chezmoi()` -
   - Check if chezmoi already exists via `command -v chezmoi`
   - If not, install via: `sh -c "$(curl -fsLS get.chezmoi.io)" -- -b "$HOME/.local/bin"`
   - Verify installation succeeded
4. `run_chezmoi_init()` -
   - Use full path `$HOME/.local/bin/chezmoi` in case not in PATH yet
   - Run: `chezmoi init --apply jackhutson/dotfiles`
   - Note: User's GitHub username is "jackhutson", repo will be "dotfiles"
5. `print_summary()` -
   - Read SUMMARY.txt from same directory as script
   - Use `dirname "$0"` to locate it
   - Print contents if file exists

**Main execution:**
```bash
main() {
    local os
    os=$(detect_os)

    stage 1 "..." "Checking prerequisites"
    check_prerequisites
    echo "  [ok] OS: $os"

    stage 2 "..." "Installing chezmoi"
    install_chezmoi
    echo "  [ok]"

    stage 3 "..." "Running chezmoi init --apply"
    run_chezmoi_init
    echo "  [ok]"

    stage 4 "..." "Complete"
    print_summary
}

main "$@"
```

Use appropriate emojis from CONTEXT.md examples (checkmark for success stages).
  </action>
  <verify>
Run: `bash -n bootstrap.sh` (syntax check)
Run: `shellcheck bootstrap.sh` if available
  </verify>
  <done>bootstrap.sh exists at repo root, passes syntax check, contains all 4 stages</done>
</task>

<task type="auto">
  <name>Task 2: Create SUMMARY.txt</name>
  <files>SUMMARY.txt</files>
  <action>
Create SUMMARY.txt at repository root with a brief post-bootstrap summary.

Content should include:
- Success message
- Quick list of what was configured (shell, git, nvim, CLI tools)
- Reminder about what user might need to do next (open new terminal, etc.)

Keep it simple and maintainable - just plain text, ~10-15 lines.

Example structure:
```
========================================
  Dotfiles Bootstrap Complete!
========================================

Configured:
  - zsh + oh-my-zsh + starship prompt
  - git with 1Password commit signing
  - nvim with LazyVim
  - CLI tools (bat, fzf, rg, eza, zoxide, lazygit)
  - Package managers (Homebrew/pacman)

Next steps:
  - Open a new terminal to load shell config
  - Run 'nvim' to let LazyVim install plugins

Happy coding!
```
  </action>
  <verify>File exists and is readable: `cat SUMMARY.txt`</verify>
  <done>SUMMARY.txt exists at repo root with post-bootstrap summary</done>
</task>

<task type="auto">
  <name>Task 3: Test bootstrap script locally</name>
  <files>None (verification only)</files>
  <action>
Test the bootstrap script components without actually running full bootstrap:

1. Verify syntax: `bash -n bootstrap.sh`
2. Test detect_os function works:
   - Source script functions or run `uname -s` manually to confirm expected output
3. Test prerequisite detection:
   - Verify git, curl, op are found on current system
4. Verify script is executable: `chmod +x bootstrap.sh` if needed

Do NOT run the full script (would reinitialize chezmoi). Just validate components.

Commit both files together:
```
git add bootstrap.sh SUMMARY.txt
git commit -m "feat(05-01): add bootstrap script for fresh machine setup

- Single curl | sh entry point
- Detects macOS vs Linux
- Checks prerequisites (git, curl, op)
- Installs chezmoi via get.chezmoi.io
- Runs chezmoi init --apply
- Shows summary on completion"
```
  </action>
  <verify>
`git log -1` shows commit with bootstrap.sh and SUMMARY.txt
`bash -n bootstrap.sh` exits 0
  </verify>
  <done>Bootstrap script committed and syntax verified</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `ls bootstrap.sh SUMMARY.txt` shows both files exist
2. `bash -n bootstrap.sh` passes syntax check
3. `grep -c "stage" bootstrap.sh` shows 4+ occurrences (one per stage)
4. `grep "chezmoi init" bootstrap.sh` shows init command
5. `grep "get.chezmoi.io" bootstrap.sh` shows official installer
6. `git log -1 --oneline` shows commit
</verification>

<success_criteria>
- bootstrap.sh exists at repo root
- SUMMARY.txt exists at repo root
- Script has all 4 stages: prerequisites, install, init, summary
- Script uses `set -euo pipefail`
- Script uses official chezmoi installer (`get.chezmoi.io`)
- Script checks for git, curl, and op (with working verification)
- Script detects OS via `uname -s`
- Both files committed to git
</success_criteria>

<output>
After completion, create `.planning/phases/05-bootstrap/05-01-SUMMARY.md`
</output>
