---
phase: 04-app-ecosystem
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - home/dot_config/nvim/
  - home/dot_config/ghostty/config
  - home/dot_config/htop/htoprc
  - home/dot_config/gh/config.yml
  - home/dot_config/kanata/kanata.kbd
  - home/.chezmoiignore
autonomous: true

must_haves:
  truths:
    - "Nvim opens with LazyVim and all customizations working"
    - "Ghostty terminal has correct configuration"
    - "htop shows configured layout"
    - "gh CLI uses configured settings"
    - "Kanata config is present on macOS devices only"
  artifacts:
    - path: "home/dot_config/nvim/init.lua"
      provides: "LazyVim entry point"
      contains: "require"
    - path: "home/dot_config/nvim/lua/config/lazy.lua"
      provides: "lazy.nvim bootstrap"
      contains: "lazy.nvim"
    - path: "home/dot_config/ghostty/config"
      provides: "Ghostty terminal config"
      min_lines: 5
    - path: "home/dot_config/gh/config.yml"
      provides: "GitHub CLI settings"
      contains: "editor:"
    - path: "home/dot_config/kanata/kanata.kbd"
      provides: "Kanata keyboard remapping (macOS)"
      contains: "defsrc"
  key_links:
    - from: "home/.chezmoiignore"
      to: "kanata config"
      via: "darwin conditional"
      pattern: "if ne.*darwin.*kanata"
---

<objective>
Migrate application configurations (nvim/LazyVim, ghostty, htop, gh CLI, kanata) into chezmoi management

Purpose: Ensure all major application configs are version-controlled and portable across devices
Output: dot_config directories for nvim, ghostty, htop, gh, kanata + updated .chezmoiignore
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-app-ecosystem/04-RESEARCH.md

# Existing ignore file to update
@home/.chezmoiignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy nvim/LazyVim configuration</name>
  <files>home/dot_config/nvim/</files>
  <action>
Copy the user's entire nvim config from `~/.config/nvim/` into `home/dot_config/nvim/`:

```bash
# Copy nvim config (excluding git and generated files)
cp -r ~/.config/nvim/* home/dot_config/nvim/

# Remove files that should not be managed:
rm -f home/dot_config/nvim/lazy-lock.json    # Auto-generated by lazy.nvim
rm -f home/dot_config/nvim/.nvimlog          # Runtime log
rm -rf home/dot_config/nvim/.git             # If nvim has its own git
rm -f home/dot_config/nvim/.DS_Store         # macOS metadata
rm -f home/dot_config/nvim/lua/.DS_Store     # nested DS_Store
```

Expected structure after copy:
```
home/dot_config/nvim/
├── .gitignore          # Keep - tells nvim's git to ignore lazy-lock
├── .neoconf.json
├── after/
├── AGENTS.md
├── init.lua
├── lazyvim.json
├── LICENSE
├── lua/
│   ├── config/
│   │   ├── autocmds.lua
│   │   ├── keymaps.lua
│   │   ├── lazy.lua       # Contains lazy.nvim bootstrap
│   │   └── options.lua
│   └── plugins/
│       └── *.lua          # All plugin configs
└── stylua.toml
```

Do NOT modify any lua files - they work as-is. The `lua/config/lazy.lua` already contains bootstrap code that clones lazy.nvim on first run.
  </action>
  <verify>Run `ls -la home/dot_config/nvim/` and `ls home/dot_config/nvim/lua/plugins/` to confirm structure. Verify `lazy-lock.json` is NOT present.</verify>
  <done>nvim config copied with all customizations, auto-generated files excluded</done>
</task>

<task type="auto">
  <name>Task 2: Copy remaining application configs</name>
  <files>
    home/dot_config/ghostty/config
    home/dot_config/htop/htoprc
    home/dot_config/gh/config.yml
    home/dot_config/kanata/kanata.kbd
  </files>
  <action>
Copy each application config from the user's system:

1. **Ghostty** (terminal emulator):
```bash
mkdir -p home/dot_config/ghostty
cp ~/.config/ghostty/config home/dot_config/ghostty/config
```

2. **htop** (process viewer):
```bash
mkdir -p home/dot_config/htop
cp ~/.config/htop/htoprc home/dot_config/htop/htoprc
```
Note: htop rewrites this file when you change settings in UI. Accept occasional drift.

3. **gh CLI** (GitHub CLI):
```bash
mkdir -p home/dot_config/gh
cp ~/.config/gh/config.yml home/dot_config/gh/config.yml
```
IMPORTANT: Do NOT copy `hosts.yml` - it contains OAuth tokens (secrets).

4. **Kanata** (keyboard remapping - macOS only):
```bash
mkdir -p home/dot_config/kanata
cp ~/.config/kanata/kanata.kbd home/dot_config/kanata/kanata.kbd
```
Note: Only the .kbd config file, not logs/plist/backups.
  </action>
  <verify>Run `ls -la home/dot_config/ghostty/ home/dot_config/htop/ home/dot_config/gh/ home/dot_config/kanata/` to confirm each config exists</verify>
  <done>ghostty, htop, gh, and kanata configs all present in chezmoi source</done>
</task>

<task type="auto">
  <name>Task 3: Update .chezmoiignore for new configs</name>
  <files>home/.chezmoiignore</files>
  <action>
Update `.chezmoiignore` to add exclusions for application configs:

Add these sections to the existing file:

```
# nvim runtime artifacts - never managed
.config/nvim/lazy-lock.json
.config/nvim/.nvimlog
.config/nvim/.luarc.json

# gh CLI secrets - never managed
.config/gh/hosts.yml

# kanata - macOS only (already have darwin conditional, ensure kanata is in it)
```

The existing `.chezmoiignore` already has:
```
{{ if ne .chezmoi.os "darwin" }}
...
.config/kanata/
{{ end }}
```

Ensure it's still there. If not, add kanata to the darwin-only section.

Also add lazygit path handling for the upcoming CLI tools plan:
```
# Lazygit: macOS uses Library path, Linux uses .config
{{ if ne .chezmoi.os "darwin" }}
Library/Application Support/lazygit/
{{ end }}
{{ if ne .chezmoi.os "linux" }}
.config/lazygit/
{{ end }}
```
  </action>
  <verify>Run `cat home/.chezmoiignore` and confirm nvim artifacts, gh hosts.yml, and lazygit paths are all listed</verify>
  <done>.chezmoiignore updated with all application-specific exclusions</done>
</task>

</tasks>

<verification>
1. `chezmoi diff` shows nvim, ghostty, htop, gh, kanata configs will be added
2. `chezmoi managed | grep -E "(nvim|ghostty|htop|gh|kanata)"` lists all new managed paths
3. `chezmoi ignored | grep -E "(lazy-lock|hosts.yml)"` confirms sensitive files are ignored
4. No template syntax errors (files are static, no .tmpl needed)
</verification>

<success_criteria>
- nvim config present with all lua files and plugins (no lazy-lock.json)
- ghostty config present
- htop config present
- gh config.yml present (NOT hosts.yml)
- kanata config present (will only apply on macOS via .chezmoiignore)
- .chezmoiignore updated with runtime artifact exclusions
</success_criteria>

<output>
After completion, create `.planning/phases/04-app-ecosystem/04-02-SUMMARY.md`
</output>
